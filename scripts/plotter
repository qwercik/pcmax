#!/usr/bin/env python3

import sys
import json
import matplotlib.pyplot as pyplot

COLORS = 'bgrcmykw'

def printHelp():
	print('Usage:', sys.argv[0], '<results>')
	print('<results> - JSON file with results generated by benchmark')

def main():
	if len(sys.argv) != 2:
		printHelp()
		sys.exit(1)
	
	resultsFilename = sys.argv[1]
	results = json.loads(open(resultsFilename).read())

	# One plot per test
	for testName, testResults in results['tests'].items():
		pyplot.figure(num=testName)
		pyplot.title(testName)
		pyplot.xlabel(results.get('legend', {}).get(testName, {}).get('arguments', ''))
		pyplot.ylabel(results.get('legend', {}).get(testName, {}).get('values', ''))

		for index, (appName, appResults) in enumerate(testResults.items()):
			x = []
			y = []

			for size, intervals in appResults.items():
				size = int(size)
				averageInterval = (sum(intervals) - min(intervals) - max(intervals)) / (len(intervals) - 2)
				x.append(size)
				y.append(averageInterval)
			
			pyplot.plot(x, y, COLORS[index] + '--', label=appName)
		
		pyplot.legend(loc="upper left")
		pyplot.show()

if __name__ == '__main__':
	main()

